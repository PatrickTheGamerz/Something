<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EToH Tower</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body { margin: 0; height: 100%; background: #0e0f14; overflow: hidden; }
    canvas { display: block; width: 100vw; height: 100vh; background: #1a1c2c; }
  </style>
</head>
<body>
  <canvas id="game"></canvas>
  <script type="module">
    import { setupPlayers, updatePlayers, drawPlayers } from './Players.js';

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const DPR = window.devicePixelRatio || 1;
    canvas.width = window.innerWidth * DPR;
    canvas.height = window.innerHeight * DPR;

    const U = 32;
    const level = {
      gravity: 900,
      platforms: [
        { x: 0, y: 13*U, w: 40*U, h: 2*U },
        { x: 10*U, y: 10*U, w: 6*U, h: 2*U },
        { x: 18*U, y: 8*U, w: 4*U, h: 2*U },
        { x: 24*U, y: 6*U, w: 4*U, h: 2*U },
        { x: 30*U, y: 9*U, w: 6*U, h: 2*U }
      ],
      spawn: { x: 2*U, y: 10*U }
    };

    const players = setupPlayers(level.spawn.x, level.spawn.y);

    let last = performance.now();
    function loop(t) {
      const dt = Math.min((t - last) / 1000, 0.033);
      last = t;

      updatePlayers(players, level, dt);

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Background gradient
      const bg = ctx.createLinearGradient(0, 0, 0, canvas.height);
      bg.addColorStop(0, '#2a2d3a');
      bg.addColorStop(1, '#0e0f14');
      ctx.fillStyle = bg;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Platforms
      ctx.fillStyle = '#a6a9b6';
      for (const p of level.platforms) {
        ctx.fillRect(p.x, p.y, p.w, p.h);
      }

      drawPlayers(ctx, players);

      requestAnimationFrame(loop);
    }

    requestAnimationFrame(loop);
  </script>
</body>
</html>
